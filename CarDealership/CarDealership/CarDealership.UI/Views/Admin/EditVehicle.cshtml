@model CarDealership.UI.Models.EditListingVM

@{
    ViewBag.Title = "EditVehicle";
}

<h2>EditVehicle</h2>

<div class="container">
    <div class="row">
        @Html.ActionLink("Back to vehicles", "Vehicles", "Admin")
        @using (Html.BeginForm("EditVehicle", "Admin", FormMethod.Post, new { enctype = "multipart/form-data", role = "form" }))
        {
            @Html.ValidationSummary("", new { @class = "text-danger" })
            @Html.HiddenFor(m => m.Listing.ListingId)
        <div class="col-md-12">
            <div class="form-group">
                <label class="col-md-2 control-label">Make</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.MakeId, Model.Makes, "-Choose-", new { @class = "form-control", @id = "makes" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.MakeId)</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Model</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.ModelId, Model.Models, "-Choose-", new { @class = "form-control", @id = "models" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.ModelId)</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Type</label>
                <div class="col-md-4">
                    @Html.EnumDropDownListFor(
                              m => m.Listing.Condition,
                              "-Choose-",
                              new { @class = "form-control" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.Condition)</span>
                </div>
            </div>
            <label class="col-md-2 control-label">Body Style</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.Listing.BodyStyleId, Model.BodyStyles, "-Choose-", new { @class = "form-control" })
                <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.BodyStyleId)</span>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.ModelYear, "Year", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.ModelYear, new { @class = "form-control", type = "number" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.ModelYear)</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Transmission</label>
                <div class="col-md-4">
                    @Html.EnumDropDownListFor(
                                  m => m.Listing.Transmission,
                                  "-Choose-",
                                  new { @class = "form-control" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.Transmission)</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Interior Color</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.InteriorColorId, Model.InteriorColors, "-Choose-", new { @class = "form-control" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.InteriorColorId)</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Exterior Color</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.ExteriorColorId, Model.ExteriorColors, "-Choose-", new { @class = "form-control" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.ExteriorColorId)</span>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.Mileage, "Mileage", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.Mileage, new { @class = "form-control", type = "number" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.Mileage)</span>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.VIN, "VIN #", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.VIN, new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.MSRP, "MSRP", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.MSRP, new { @class = "form-control", type = "number" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.MSRP)</span>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.SalePrice, "Sale Price", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.SalePrice, new { @class = "form-control", type = "number" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.SalePrice)</span>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.VehicleDescription, "Descripton", new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.TextAreaFor(m => m.Listing.VehicleDescription, new { @class = "form-control", @rows = "6", @cols = "40" })
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.Listing.VehicleDescription)</span>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.ImageFileUrl, "Image", new { @class = "col-md-2 control-label" })
                <div class="col-md-10">
                    <input id="ImageUpload" name="ImageUpload" type="file" class="form-control" />
                    <span class="text-danger">@Html.ValidationMessageFor(m => m.ImageUpload)</span>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox col-md-offset-2 col-md-2">
                    <label>
                        @Html.CheckBoxFor(m => m.Listing.IsFeatured) Feature this vehicle?
                    </label>
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-10">
                    @{ var imagePath = Url.Content("~/Images/");
                    }
                    <p class="recentListing"><img src="@(imagePath + Model.Listing.ImageFileUrl)" width="150" /></p>
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-1">
                    @Html.ActionLink("Delete", "DeleteListing", "Admin", new { listingId = Model.Listing.ListingId }, new { @class = "btn btn-danger" })
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-1">
                    <input type="submit" class="btn" value="Edit" />
                </div>
            </div>
        </div>
        }
    </div>
</div>


@section Scripts
{
    <script>
        $(document).ready(function () {
            $("#makes").change(function (e) {
                var makeVal = $(this).find(':selected').val();
                var makeText = $(this).find(':selected').text();
                if (makeVal > 0) {
                    getModels();
                }
                return false;
            });

        });
        function getModels() {
            var makeVal = $("#makes").find(':selected').val();
            var makeText = $("#makes").find(':selected').text();
            var params = '&makeid=' + makeVal
            $.ajax({
                type: 'GET',
                url: 'http://localhost:57967/api/get/models?' + params,
                success: function (data) {
                    $('#models').empty();
                    $.each(data, function (index, models) {
                        var modelList = "<option value=" + models.ModelId + ">" + models.ModelName + "</option>";
                        $(modelList).appendTo("#models")
                    })
                },
                error: function () {
                    alert('Error finding models for make ' + makeText)
                }
            })
        }
    </script>
}