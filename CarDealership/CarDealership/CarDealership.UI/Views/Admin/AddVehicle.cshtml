@model CarDealership.UI.Models.AddListingVM

@{
    ViewBag.Title = "AddVehicle";
}

<h2>AddVehicle</h2>

<div class="container">
    <div class="row">
        @using (Html.BeginForm("AddVehicle", "Admin", FormMethod.Post, new { enctype = "multipart/form-data", role = "form" }))
        {
            @Html.ValidationSummary("", new { @class = "text-danger" })
            <div class="form-group">
                <label class="col-md-2 control-label">Make</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.MakeId, Model.Makes, "-Choose-" ,new { @class = "form-control", @id = "makes" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Model</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.ModelId, Model.Models, "-Choose-", new { @class = "form-control", @id = "models" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Type</label>
                <div class="col-md-4">
                    @Html.EnumDropDownListFor(
                          m => m.Listing.Condition,
                          "-Choose-",
                          new { @class = "form-control" })
                </div>
            </div>
            <label class="col-md-2 control-label">Body Style</label>
            <div class="col-md-4">
                @Html.DropDownListFor(m => m.Listing.BodyStyleId, Model.BodyStyles, "-Choose-", new { @class = "form-control" })
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.ModelYear, "Year", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.ModelYear, new { @class = "form-control", type = "number" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Transmission</label>
                <div class="col-md-4">
                    @Html.EnumDropDownListFor(
                          m => m.Listing.Transmission,
                          "-Choose-",
                          new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Interior Color</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.InteriorColorId, Model.InteriorColors, "-Choose-", new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-2 control-label">Exterior Color</label>
                <div class="col-md-4">
                    @Html.DropDownListFor(m => m.Listing.ExteriorColorId, Model.ExteriorColors, "-Choose-", new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.Mileage, "Mileage", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.Mileage, new { @class = "form-control", type = "number" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.VIN, "VIN #", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.VIN, new { @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.MSRP, "MSRP", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.MSRP, new { @class = "form-control", type = "number" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.SalePrice, "Sale Price", new { @class = "control-label col-md-2" })
                <div class="col-md-4">
                    @Html.TextBoxFor(m => m.Listing.SalePrice, new { @class = "form-control", type = "number" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.VehicleDescription, "Descripton", new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.TextAreaFor(m => m.Listing.VehicleDescription, new { @class = "form-control", @rows = "6", @cols = "40" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Listing.ImageFileUrl, "Image" , new { @class = "col-md-2 control-label" })
                <div class="col-md-10">
                    <input id="ImageUpload" name="ImageUpload" type="file" class="form-control"/>
                    @*@Html.TextBoxFor(m => m.ImageUpload, new { type = "file", @class = "form-control"})*@
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-4">
                    <input type="submit" class="btn btn-primary" value="Save" />
                </div>
            </div>
        }
    </div>
</div>


@section Scripts
{
    <script>
        $(document).ready(function () {
            $("#makes").change(function (e) {
                var makeVal = $(this).find(':selected').val();
                var makeText = $(this).find(':selected').text();
                if (makeVal > 0) {
                    getModels();
                }
                return false;
            });

        });
        function getModels() {
            var makeVal = $("#makes").find(':selected').val();
            var makeText = $("#makes").find(':selected').text();
            var params = '&makeid=' + makeVal
            $.ajax({
                type: 'GET',
                url: 'http://localhost:57967/api/get/models?' + params,
                success: function (data) {
                    $('#models').empty();
                    $.each(data, function (index, models) {
                        var modelList = "<option value=" + models.ModelId + ">" + models.ModelName + "</option>";
                        $(modelList).appendTo("#models")
                    })
                },
                error: function () {
                    alert('Error finding models for make ' + makeText)
                }
            })
        }
    </script>
}

